<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Operator's Guide - esnet-smartnic-tutorial</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atelier-dune-light.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">esnet-smartnic-tutorial</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../1-lesson1/" class="nav-link">Getting Started</a>
                            </li>
                            <li class="navitem">
                                <a href="../2-lesson2/" class="nav-link">esnet-smartnic-hw</a>
                            </li>
                            <li class="navitem">
                                <a href="../3-lesson3/" class="nav-link">P4 Simulation</a>
                            </li>
                            <li class="navitem">
                                <a href="../4-lesson4/" class="nav-link">RTL Simulation</a>
                            </li>
                            <li class="navitem">
                                <a href="../5-lesson5/" class="nav-link">The ESnet Stack</a>
                            </li>
                            <li class="navitem">
                                <a href="../6-lesson6/" class="nav-link">esnet-smartnic-fw</a>
                            </li>
                            <li class="navitem">
                                <a href="../7-lesson7/" class="nav-link">DPDK</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Operator's Guide</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../7-lesson7/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#using-xilinx-alveo-fpgas-as-smartnics-with-esnet-framework" class="nav-link">Using Xilinx Alveo FPGAs as SmartNICs with ESnet Framework</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#appendix-a-operators-guide" class="nav-link">Appendix A: Operator's Guide</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#completion-and-references" class="nav-link">Completion and References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#known-issues" class="nav-link">Known Issues</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="using-xilinx-alveo-fpgas-as-smartnics-with-esnet-framework">Using Xilinx Alveo FPGAs as SmartNICs with ESnet Framework</h1>
<h2 id="appendix-a-operators-guide"><strong>Appendix A: Operator's Guide</strong></h2>
<p>This guide provides an in-depth walkthrough of the process involved in harnessing the capabilities of Xilinx Alveo FPGAs as SmartNICs within the ESnet Framework. Divided into two core sections, the guide outlines the steps required for both development and deployment phases.</p>
<hr />
<h3 id="development-phase"><strong>Development Phase</strong></h3>
<p>The development phase is a critical initial step, encompassing the setup of a conducive environment for crafting, testing, and compiling P4 programs. These programs will eventually be transformed into executable artifacts capable of running on Xilinx Alveo FPGAs.</p>
<p><strong>1. Installation and Configuration of the Vivado Runtime Environment</strong></p>
<p>To commence, it is imperative to install the AMD (Xilinx) Vivado tool suite, incorporating the VitisNetP4 option. This entails setting the <code>VitisNetP4_Option_VISIBLE</code> environment variable to <code>true</code> before initiating the installation process. Execute the following BASH shell command:</p>
<p><code>export VitisNetP4_Option_VISIBLE=true</code></p>
<p><strong>2. Configuring the Runtime Environment</strong></p>
<p>Execute the <code>settings64.sh</code> script located in the Vivado installation directory to configure the runtime environment effectively:</p>
<p><code>source /tools/Xilinx/Vivado/2023.1/settings64.sh</code></p>
<p>Remember, in this illustration, the Vivado installation directory is situated at <code>/tools/Xilinx/Vivado/2023.1/</code>.</p>
<p><strong>3. Resolving License Dependencies</strong></p>
<p>The <code>XILINXD_LICENSE_FILE</code> environment variable needs proper configuration to facilitate license resolution for the AMD (Xilinx) VitisNetp4 IP core. This can be achieved using a <code>.flexlmrc</code> file in the user's home directory or a dedicated BASH script file (like <code>.bashrc</code>). Execute the following BASH shell command as an example:</p>
<p><code>export XILINXD_LICENSE_FILE=&lt;filename&gt;</code></p>
<p>Once these steps are completed and you have a valid VitisNetworkingP4 license, your environment will be primed for the development of P4 programs tailored for Xilinx Alveo FPGA cards.</p>
<hr />
<h3 id="deployment-phase"><strong>Deployment Phase</strong></h3>
<p>The deployment phase entails transferring the compiled bitfiles onto Xilinx Alveo FPGAs. To accomplish this, follow these sequential steps:</p>
<p><strong>1. Ensuring Compatibility and Environment</strong></p>
<p>Ensure that your system operates within a Linux environment, ideally Ubuntu 20.04, for a stable and reproducible deployment.</p>
<p><strong>2. FPGA Connectivity Check</strong></p>
<p>Validate that your host system is equipped with at least one Xilinx FPGA (U280, U55C, U250). Confirm this by running the command:</p>
<p><code>lspci -d 10ee</code></p>
<p>This command will display any PCIe-connected FPGAs.</p>
<p><strong>3. Configuring Hugepages</strong></p>
<p>Verify that hugepages are appropriately configured by examining the kernel boot command line parameters:</p>
<p><code>cat /proc/cmdline</code></p>
<p>Ensure that the output includes lines similar to:</p>
<pre><code>BOOT_IMAGE=/boot/vmlinuz-5.4.0-126-generic root=/dev/mapper/vg0-root ro default_hugepagesz=1G hugepagesz=1G hugepages=32 intel_iommu=on iommu=pt
</code></pre>
<p><strong>4. Grub Configuration</strong></p>
<p>Edit the <code>/etc/default/grub</code> file to include the following line:</p>
<p><code>GRUB_CMDLINE_LINUX_DEFAULT="default_hugepagesz=1G hugepagesz=1G hugepages=32 intel_iommu=on iommu=pt"</code></p>
<p>Subsequently, execute:</p>
<p><code>sudo update-grub</code></p>
<p><strong>5. IOMMU Confirmation</strong></p>
<p>Verify IOMMU is enabled by examining the log:</p>
<p><code>sudo less /var/log/kern.log</code></p>
<p><strong>6. JTAG/USB Connection Check</strong></p>
<p>Ensure that the FPGA has JTAG/USB connectivity by running:</p>
<p><code>lsusb</code></p>
<p>Confirm the presence of the device labeled "Future Technology Devices International, Ltd FT232H Single HS USB-UART/FIFO," which signifies the JTAG connection to the FPGA.</p>
<p><strong>7. Docker Setup</strong></p>
<p>Install Docker along with the <code>docker-compose-plugin</code> and <code>docker-buildx-plugin</code>. Detailed instructions can be found in <a href="https://docs.docker.com/engine/install/ubuntu/">Docker's official documentation</a>.</p>
<p><strong>8. Post-Installation Configuration</strong></p>
<p>Follow the post-installation steps outlined in <a href="https://docs.docker.com/engine/install/linux-postinstall/">Docker's documentation</a> to grant non-privileged users the ability to execute Docker commands and to implement optional configurations.</p>
<hr />
<h2 id="completion-and-references"><strong>Completion and References</strong></h2>
<p>With the successful completion of these phases, your setup is now ready for operation. Should you need further information, the following documents are accessible from the AMD (Xilinx) Vitis Networking P4 Secure Site (upon granted access):</p>
<ul>
<li><em>Vitis Networking P4 Installation Guide and Release Notes, UG1307 (v2023.1) May 10, 2023</em>.</li>
<li><em>Vitis Networking P4 User Guide, UG1308 (v2023.1) May 16, 2023</em>.</li>
<li><em>Vitis Networking P4 Getting Started Guide, UG1373 (v2023.1) May 16, 2023</em>.</li>
</ul>
<p>Additionally, you may find valuable resources at <a href="https://p4.org/">https://p4.org/</a>.</p>
<h2 id="known-issues"><strong>Known Issues</strong></h2>
<p>As of now, no known issues have been reported. Your experience should be seamless.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
